<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <title>Instagram Bot</title>

    <!-- Bootstrap core CSS -->
    <link href="/templates/panel/assets/css/bootstrap.css" rel="stylesheet">
    <!--external css-->
    <link href="/templates/panel/assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
        
    <!-- Custom styles for this template -->
    <link href="/templates/panel/assets/css/style.css" rel="stylesheet">
    <link href="/templates/panel/assets/css/style-responsive.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

  <section id="container" >
      <!-- **********************************************************************************************************************************************************
      TOP BAR CONTENT & NOTIFICATIONS
      *********************************************************************************************************************************************************** -->
      <!--header start-->
      <header class="header black-bg">
              <div class="sidebar-toggle-box">
                  <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
              </div>
            <!--logo start-->
            <a href="index.html" class="logo"><b>Instagram Bot</b></a>
            <!--logo end-->

            
        </header>
      <!--header end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">
                    
              	  <p class="centered"><a><img src="/templates/panel/assets/img/ui-sam.jpg" class="img-circle" width="60"></a></p>
              	    <button id="createbot">create bot</button>
                    {% for bot in bots%}
                    <li class="mt">
                        {% if activated.id == bot.id %}
                        <a class="active" href="/api/{{bot.id}}/dashboard">
                            <i class="fa fa-dashboard"></i>
                            <span>{{bot.name}}</span>
                        </a>
                        {%else%}
                        <a href="/api/{{bot.id}}/dashboard">
                            <i class="fa fa-dashboard"></i>
                            <span>{{bot.name}}</span>
                        </a>
                        {%endif%}
                    </li>
                  {% endfor %}
          </div>
      </aside>
      <!--sidebar end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN CONTENT
      *********************************************************************************************************************************************************** -->
      <!--main content start-->
      <section id="main-content">
          <section class="wrapper site-min-height">
          	<h2><i class="fa fa-angle-right"></i><b> Dashboard</b></h2>
              <div class="details col-md-4 mb">
                            <div class="white-panel pn">
                                <div class="white-header">
                                    <h5><a target="blank" class="link">Open Page</a></h5>
                                </div>
                                <div class="span_click_tag">
                                    <p><img class="img-circle" width="80"></p>
                                    <p><b><span class="user_name"></span></b></p>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p class="small mt">Follower</p>
                                            <p class="follower"></p>
                                        </div>
                                        <div class="col-md-6">
                                            <p class="small mt">Following</p>
                                            <p class="following"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                <div class="row mt">
                    <div class="row mt">

                    <div class="col-lg-12">
                        <div class="form-panel">
                        <h4 class="mb"><i class="fa fa-angle-right"></i> Config</h4>
                            <form class="form-horizontal tasi-form" method="post" action="/api/{{activated.id}}/setconfig">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputSuccess">Username</label>
                                    <div class="col-lg-10">
                                        <input value="{{activated.username}}" type="text" class="form-control" id="username" name="username">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputSuccess">Password</label>
                                    <div class="col-lg-10">
                                        <input value="{{activated.password}}" type="text" class="form-control" id="password" name="password">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputSuccess">Like Per Day</label>
                                    <div class="col-lg-10">
                                        <input value={{activated.like_per_day}} type="text" class="form-control" id="like_per_day" name="like_per_day">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputSuccess">Comment Per Day</label>
                                    <div class="col-lg-10">
                                        <input value={{activated.comment_per_day}} type="text" class="form-control" id="comment_per_day" name="comment_per_day">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputSuccess">Follow Per Day</label>
                                    <div class="col-lg-10">
                                        <input value={{activated.follow_per_day}} type="text" class="form-control" id="follow_per_day" name="follow_per_day">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputSuccess">Unfollow Per Day</label>
                                    <div class="col-lg-10">
                                        <input value="{{activated.unfollow_per_day}}" type="text" class="form-control" id="unfollow_per_day" name="unfollow_per_day">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputSuccess">Comments Text (Seprate by "*" )</label>
                                    <div class="col-lg-10">
                                        <input value="{{activated.comments}}" type="text" class="form-control" id="comment_text" name="comment_text">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputSuccess">Second Username</label>
                                    <div class="col-lg-10">
                                        <input value="{{activated.second_username}}" type="text" class="form-control" id="username" name="second_username">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputSuccess">Second Password</label>
                                    <div class="col-lg-10">
                                        <input value="{{activated.second_password}}" type="text" class="form-control" id="password" name="second_password">
                                    </div>
                                </div>
                                <input id="save-btn" type="submit" class="btn btn-primary" value="save">
                            </form>
                        </div><!-- /form-panel -->
                    </div><!-- /col-lg-12 -->
                    
                    <div class="col-lg-12">
                        <div class="form-panel">
                        <h4 class="mb"><i class="fa fa-angle-right"></i> Follow Targets</h4>
                            <form class="form-horizontal tasi-form">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputSuccess">Target Name</label>
                                    <div class="col-lg-10">
                                        <input type="text" class="form-control" id="search" name="name">
                                        
                                    </div>
                                    
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputError">Action</label>
                                    <div class="col-lg-10">
                                        <label class="checkbox-inline">
                                            <input type="checkbox" id="a_f" value="F" name="action_f"> Follow
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="checkbox" id="a_l" value="L" name="action_l"> Like
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="checkbox" id="a_c" value="C" name="action_c"> Comment
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputError">Action</label>
                                    <div class="col-lg-10">
                                        <label class="checkbox-inline">
                                            <input type="radio" id="f_f" value="F" name="follows"> Followers
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="radio" id="f_l" value="L" name="follows"> Likers
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label col-lg-2" for="inputSuccess">Filter Followers</label>
                                    <div class="col-lg-10">
                                        <input placeholder="from" type="text" id="from">
                                        <input placeholder="to" type="text"  id="to">
                                    </div> 
                                </div>
                                <button id="search-btn" type="button" class="btn btn-primary">Search</button>
                                <hr>
                                <button id="followall" type="button" class="btn btn-primary">Follow All</button>
                                <div id="res" style="overflow:auto; width:100%; max-height:600px;">
                                
                                    </div>
                            </form>
                        </div><!-- /form-panel -->
                    </div><!-- /col-lg-12 -->
                </div><!-- /row -->
                <div class="col-md-12">
                      <div class="content-panel">
                          <table class="table table-striped table-advance table-hover">
	                  	  	  <h4><i class="fa fa-angle-right"></i> Targets</h4>
	                  	  	  <hr>
                              <thead>
                              <tr>
                                  <th><i class="fa fa-bullhorn"></i> Name</th>
                                  <th class="hidden-phone"><i class="fa fa-question-circle"></i> Type</th>
                                  <th><i class=" fa fa-question-circle"></i> Follow From</th>
                                  <th><i class="fa fa-bookmark"></i> Action</th>
                                  <th></th>
                              </tr>
                              </thead>
                              <tbody>
                              {% for target in targets %}
                              <tr>
                                  <td><a>{{target.target}}</a></td>
                                  <td class="hidden-phone">{{target.get_target_type_display}}</td>
                                  <td><input type="radio" name="follows_{{target.id}}" value="F" {%if target.target_follows == 'F'%} checked {% endif %} id="followschange">Followers <input type="radio" name="follows_{{target.id}}" value="L" {%if target.target_follows == 'L'%} checked {% endif %} id="followschange">Likers</td>
                                  <td>{{target.target_action}}</td>
                                  <td>
                                      <a href="/api/{{activated.id}}/deletetarget/{{target.id}}"><button class="btn btn-danger btn-xs"><i class="fa fa-trash-o "></i></button></a>
                                  </td>
                              </tr>
                              {% endfor %}
                              </tbody>
                          </table>
                      </div><!-- /content-panel -->
                  </div><!-- /col-md-12 -->
          	</div>
			
		</section><! --/wrapper -->
      </section><!-- /MAIN CONTENT -->

      
      <!--main content end-->
      <!--footer start-->
      <footer class="site-footer">
          <div class="text-center">
              Seyed Morteza Hosseini
              <a href="blank.html#" class="go-top">
                  <i class="fa fa-angle-up"></i>
              </a>
          </div>
      </footer>
      <!--footer end-->
  </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <script src="/templates/panel/assets/js/jquery.js"></script>
    <script src="/templates/panel/assets/js/bootstrap.min.js"></script>
    <script src="/templates/panel/assets/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="/templates/panel/assets/js/jquery.ui.touch-punch.min.js"></script>
    <script class="include" type="text/javascript" src="/templates/panel/assets/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="/templates/panel/assets/js/jquery.scrollTo.min.js"></script>
    <script src="/templates/panel/assets/js/jquery.nicescroll.js" type="text/javascript"></script>


    <!--common script for all pages-->
    {# <script src="/templates/panel/assets/js/common-scripts.js"></script> #}

    <!--script for this page-->
    <script src="/templates/panel/assets/js/form-component.js"></script>    

  <script>
  var targets;
  function fetchDetails() {
      var username = "{{activated.username}}"
      var url = "https://www.instagram.com/" + username + "/?__a=1"
      $.get(url, function(data){
          var profile_pic = data.graphql.user.profile_pic_url_hd
          var followers = data.graphql.user.edge_followed_by.count
          var following = data.graphql.user.edge_follow.count
          $('.details .link').prop("href", url)
          $('.details .img-circle').prop("src", profile_pic)
          $('.details .following').html(following)
          $('.details .follower').html(followers)
      })
  }
  fetchDetails()
      //custom select box
$('#search-btn').on('click', function() {
            
              var url = "https://www.instagram.com/web/search/topsearch/?query=" + $("#search").val()
              $.get(url, function(data){
                  targets = []
                  $("#res").html("")
                  users = data.users
                  hashtags = data.hashtags
                  for(let i = 0; i < hashtags.length; i++) {
                    $("#res").append('<div class="col-md-4 mb">\
                                                <div class="white-panel pn">\
                                                    <div class="white-header">\
                                                        <h5><a target="blank" href="' + "https://www.instagram.com/explore/tags/" + hashtags[i].hashtag.name + '" >Show Hashtag</a></h5>\
                                                    </div>\
                                                    <div class="span_click_tag">\
                                                        <p><img src="/templates/panel/assets/img/tag.jpg" class="img-circle" width="80"></p>\
                                                        <p><b><span class="user_name">' + hashtags[i].hashtag.name + '</span></b></p>\
                                                        <div class="row">\
                                                            <div class="col-md-6">\
                                                                <p class="small mt">Media Count</p>\
                                                                <p>' + hashtags[i].hashtag.media_count + '</p>\
                                                            </div>\
                                                        </div>\
                                                    </div>\
                                                </div>\
                                            </div>')
                  }
                  function app(obj) {
                      $("#res").append('<div class="col-md-4 mb">\
                                                    <div class="white-panel pn">\
                                                        <div class="white-header">\
                                                            <h5><a target="blank" href="' + "https://www.instagram.com/" + obj.user.username + '" >Open Page</a></h5>\
                                                        </div>\
                                                        <div class="span_click_page">\
                                                            <p><img src=' + obj.user.profile_pic_url +' class="img-circle" width="80"></p>\
                                                            <p><b><span class="user_name">' + obj.user.username + '</span></b></p>\
                                                            <div class="row">\
                                                                <div class="col-md-6">\
                                                                    <p class="small mt">Followers</p>\
                                                                    <p>' + obj.user.follower_count + '</p>\
                                                                </div>\
                                                                <div class="col-md-6">\
                                                                    <p class="small mt">' + (obj.user.is_private ? 'private' : 'public') + '</p>\
                                                                </div>\
                                                            </div>\
                                                        </div>\
                                                    </div>\
                                                </div>')
                  }
                  for(let i = 0; i < users.length; i++) {
                    if (($("#from").val() == "" || ($("#from").val() != "" && users[i].user.follower_count > parseInt($("#from").val()))) 
                        && ($("#to").val() == "" || ($("#to").val() != "" && users[i].user.follower_count < parseInt($("#to").val())))) {
                        app(users[i])
                        targets.push(users[i])
                    }
                  }
          })
})
        $(document).on('click', '.span_click_page',function(){
            var packedData = getPackedData()
            packedData.type = 'P'
            packedData.target = $(this).find('.user_name').text()
            console.log(packedData)
            $.ajax({
                url: '/api/{{activated.id}}/addtarget',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(packedData),
                dataType: 'text',
                success: function(result) {
                    if (result == 'already')
                        alert('قبلا اضافه شده')
                    else 
                        alert('اضافه شد')
                }
            });
        }) 
        $(document).on('click', '.span_click_tag',function(){
            var packedData = getPackedData()
            packedData.type = 'T'
            packedData.target = $(this).find('.user_name').text()
            console.log(packedData)
            $.ajax({
                url: '/api/{{activated.id}}/addtarget',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(packedData),
                dataType: 'text',
                success: function(result) {
                    if (result == 'already')
                        alert('قبلا اضافه شده')
                    else 
                        alert('اضافه شد')
                }
            });
        }) 
        $("#followall").on('click', function() {
            var packedData = getPackedData()
            packedData.targets = targets
            $.ajax({
                url: '/api/{{activated.id}}/addpagegroup',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(packedData),
                dataType: 'text',
                success: function(res) {
                    console.log(result)
                    var result = JSON.parse(res)
                    alert(result['already'] + " of the pages was already added and " + result['success'] + " are successfully added")
                }
            });
        })
        $('input[type=radio][id="followschange"').on('change', function() {
            var idOfTarget = ($(this).attr('name').split("_")[1])
            var newFollows = $(this).val()
            var data = {id: idOfTarget, state: newFollows}
            $.ajax({
                url: '/api/{{activated.id}}/changefollowsstate',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(data),
                dataType: 'text',
                success: function(result) {
                    alert("successfully changed")
                }
            });
        })
        $('#createbot').on('click', function() {
            var name = prompt("name?")
            var data = {name: name}
            $.ajax({
                url: '/api/createbot',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(data),
                dataType: 'text',
                success: function(result) {
                    alert("successfully created!")
                }
            });
        })
        function getPackedData() {
            var res = {}
            res.a_c = false;
            res.a_f = false;
            res.a_l = false;
            res.follows = 'F'
            if ($("#f_l").is(":checked")) {
                res.follows = 'L'
            }
            if($("#a_c").is(':checked')){
                res.a_c = true
            }
            if($("#a_f").is(':checked')){
                res.a_f = true
            }
            if($("#a_l").is(':checked')){
                res.a_l = true
            }
            return res
        }
      $(function(){
          $('select.styled').customSelect();

          
      });

  </script>

  </body>
</html>
